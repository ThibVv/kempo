name: SonarCloud Analysis (Legacy)

# Ce workflow est maintenant intégré dans les autres pipelines
# Conservé pour référence et tests manuels

on:
  workflow_dispatch:  # Déclenchement manuel uniquement
  schedule:
    - cron: '0 2 * * 1'  # Analyse hebdomadaire le lundi à 2h

jobs:
  sonarcloud-manual:
    name: SonarCloud Manual Analysis
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install Backend Dependencies
      run: |
        cd backend
        npm ci
    
    - name: Install Frontend Dependencies
      run: |
        cd front
        npm ci
    
    - name: Run Backend Tests with Coverage
      run: |
        cd backend
        npm run test:coverage || echo "Backend tests completed"
    
    - name: Run Frontend Tests with Coverage
      run: |
        cd front
        npm run test:coverage || echo "Frontend tests completed"
    
    - name: SonarCloud Scan
      uses: SonarSource/sonarcloud-github-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      with:
        args: >
          -Dsonar.projectKey=ThibVv_kempo
          -Dsonar.organization=thibvv
